# Настройка автоматической расстановки книг с помощью ИИ

## Описание функции

Система автоматической расстановки книг использует ИИ Gemini Flash 2.5 для оптимального размещения книг без полок на соответствующих полках библиотеки.

## Основные возможности

1. **Интеллектуальный анализ**: ИИ анализирует категоризацию, жанры, авторов и ISBN книг
2. **Оптимальное размещение**: Книги размещаются на полках согласно их тематике
3. **Выборочное применение**: Возможность выбрать только нужные предложения из списка ИИ
4. **Визуальное выделение**: Книги, размещенные ИИ, имеют специальную подсветку с градиентом и анимацией
5. **Функция отмены**: Полная отмена автоматической расстановки одним кликом
6. **Предварительный просмотр**: Просмотр предложений ИИ перед применением

## Настройка

### 1. API ключ Gemini

Добавьте в переменные окружения (.env.local):

```
NEXT_PUBLIC_GEMINI_API_KEY=ваш_api_ключ_gemini
```

Получить API ключ можно на: https://aistudio.google.com/app/apikey

### 2. Структура данных

Система использует следующие поля из типа Book:
- `categorization` - основная категоризация книги
- `genre` - жанр книги
- `authors` - авторы
- `isbn` - ISBN код
- `title` - название

## Использование

### 1. Запуск автоматической расстановки

1. Перейдите на страницу "Управление полками"
2. Нажмите кнопку "ИИ Расстановка"
3. В модальном окне нажмите "Запустить автоматическую расстановку"

### 2. Просмотр предложений

ИИ покажет список книг с предлагаемыми полками и позициями:
- Название и автор книги
- Жанр и категоризация
- Целевая полка и позиция

### 3. Выборочное применение

После получения предложений от ИИ вы можете:
- **Выбрать отдельные предложения**: Используйте чекбоксы для выбора нужных книг
- **Выбрать все**: Кнопка для выбора всех предложений
- **Снять выбор**: Кнопка для снятия всех выборов
- **Применить выбранные**: Размещает только выбранные книги
- **Отменить**: Отклоняет все предложения ИИ

Каждое предложение можно включить или исключить индивидуально, что дает полный контроль над процессом размещения.

### 4. Визуальные индикаторы

Книги, размещенные ИИ, отображаются с:
- Градиентной заливкой (зелено-синий для доступных, красно-синий для недоступных)
- Фиолетовой рамкой
- Анимацией пульсации
- Тенью для объемности

### 5. Отмена размещения

После применения автоматической расстановки появляется кнопка "Отменить ИИ":
- Удаляет все книги, размещенные ИИ, с полок
- Возвращает их в список книг без полок
- Полностью откатывает изменения

## Алгоритм работы ИИ

1. **Анализ полок**: ИИ получает информацию о всех полках (категория, вместимость, занятость)
2. **Анализ книг**: Обрабатывает книги без полок с их метаданными
3. **Сопоставление**: Находит оптимальные соответствия книг и полок
4. **Валидация**: Проверяет вместимость полок и доступность позиций
5. **Предложения**: Возвращает список рекомендаций с обоснованием

## Правила размещения ИИ

Приоритет соответствия (по убыванию):
1. Категоризация книги и рубрика полки
2. Жанр книги
3. Группировка по авторам
4. Тематическое соответствие

## Ограничения

- Требуется настроенный API ключ Gemini
- Работает только с книгами без полок
- Учитывает только доступные места на полках
- Одна активная расстановка ИИ за раз

## Устранение неполадок

### Ошибка "API ключ Gemini не настроен"
Убедитесь, что переменная NEXT_PUBLIC_GEMINI_API_KEY задана в .env.local

### Ошибка API Gemini
Проверьте:
- Валидность API ключа
- Квоты использования Gemini API
- Подключение к интернету

### Нет предложений от ИИ
- Проверьте, есть ли книги без полок
- Убедитесь, что на полках есть свободные места
- Проверьте качество метаданных книг (категоризация, жанр)

## Техническая информация

- **Модель ИИ**: Gemini 2.0 Flash Experimental
- **Максимальный размер запроса**: Ограничен API Gemini
- **Формат обмена**: JSON
- **Валидация**: Клиентская проверка всех предложений ИИ 